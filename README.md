# üìñ README
# –ù–∞—à –ø–æ–¥—Ö–æ–¥ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ù–∞—à **—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **Spring Boot**. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —Å—Ç–µ–∫–∞ –¥–∞–µ—Ç –Ω–∞–º –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–∞–º–∏—Ö —Ç–µ—Å—Ç–æ–≤:

*   **–ú–æ—â–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (DI)** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏ –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ—Å—Ç–æ–≤: —Ä–∞–∑–ª–∏—á–Ω—ã–µ API-–∫–ª–∏–µ–Ω—Ç—ã (HTTP, NATS –∏ –¥—Ä.), –∫–ª–∏–µ–Ω—Ç—ã –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö, —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π (Kafka), —É—Ç–∏–ª–∏—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ –±–æ–ª–µ–µ **–º–æ–¥—É–ª—å–Ω—ã–º, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –∏ —á–∏—Ç–∞–µ–º—ã–º**.
*   Kafka-—Ö–µ–ª–ø–µ—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (`PlayerAccountKafkaClient`, `WalletProjectionKafkaClient`, `GameSessionKafkaClient`, `LimitKafkaClient`), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ —Ç–µ—Å—Ç—ã –±–µ–∑ –æ–±—â–µ–≥–æ —Ñ–∞—Å–∞–¥–∞.
*   **–ê–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `@SpringBootTest` —É–ø—Ä–æ—â–∞—é—Ç **–Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –∏ –∑–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—è –Ω—É–∂–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –±–∏–Ω—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ—Å—Ç–∞.
*   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π** (—á–µ—Ä–µ–∑ `application.properties/.yml` –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `@Value`) –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã –≥–∏–±–∫–∏–º–∏ –∏ –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º—ã–º–∏ –∫ —Ä–∞–∑–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è–º.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ, Spring Boot –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–º —Å—Ç—Ä–æ–∏—Ç—å **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é, –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É**, —Å–ø–æ—Å–æ–±–Ω—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

*   [üìñ –ì–∞–π–¥ –ø–æ –æ—Ç–ø—Ä–∞–≤–∫–µ HTTP‚Äë–∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ Feign –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ—Ç–≤–µ—Ç–∞ (–ø—Ä–∏–º–µ—Ä: ¬´–°—Ç–∞–≤–∫–∞¬ª)](#–≥–∞–π–¥-–ø–æ-–æ—Ç–ø—Ä–∞–≤–∫–µ-http–∑–∞–ø—Ä–æ—Å–∞-–∏-–ø—Ä–æ–≤–µ—Ä–∫–µ-–æ—Ç–≤–µ—Ç–∞)
    *   [1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞](#1-—Å–æ–∑–¥–∞—Ç—å-–º–æ–¥–µ–ª—å-–¥–ª—è-—Ç–µ–ª–∞-–∑–∞–ø—Ä–æ—Å–∞)
    *   [2. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞](#2-—Å–æ–∑–¥–∞—Ç—å-–º–æ–¥–µ–ª—å-–¥–ª—è-—Ç–µ–ª–∞-–æ—Ç–≤–µ—Ç–∞)
    *   [3. –û–ø–∏—Å–∞—Ç—å HTTP‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ Feign‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ](#3-–æ–ø–∏—Å–∞—Ç—å-http—ç–Ω–¥–ø–æ–∏–Ω—Ç-–≤-feign–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ)
    *   [4. –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `ManagerClient` –≤ —Ç–µ—Å—Ç](#4-–∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å-managerclient-–≤-—Ç–µ—Å—Ç)
    *   [5. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å](#5-—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å-–∑–∞–ø—Ä–æ—Å)
    *   [6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å](#6-–æ—Ç–ø—Ä–∞–≤–∏—Ç—å-–∑–∞–ø—Ä–æ—Å)
    *   [7. –°–¥–µ–ª–∞—Ç—å –∞—Å—Å–µ—Ä—Ç—ã](#7-—Å–¥–µ–ª–∞—Ç—å-–∞—Å—Å–µ—Ä—Ç—ã)
    *   [8. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ –∏ –∞—Ç—Ç–∞—á–∏ –¥–ª—è Allure ‚ú®](#8-–Ω–µ-–ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å-–∑–∞-–∞—Ç—Ç–∞—á–∏-)
    *   [9. –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ (`BetApiTest.java`)](#9-–ø–æ–ª–Ω—ã–π-–ø—Ä–∏–º–µ—Ä-—Ç–µ—Å—Ç–æ–≤–æ–≥–æ-–∫–ª–∞—Å—Å–∞-betapitestjava)
*   [‚öôÔ∏è –†–∞–±–æ—Ç–∞ —Å Kafka](#—Ä–∞–±–æ—Ç–∞-—Å-kafka)
    *   [1. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å Kafka](#1-–∫–∞–∫-—É—Å—Ç—Ä–æ–µ–Ω–∞-—Ä–∞–±–æ—Ç–∞-—Å-kafka)
    *   [2. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ](#2-–∫–∞–∫-–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
    *   [3. –ì–¥–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å –±—Ä–æ–∫–µ—Ä–∞](#3-–≥–¥–µ-–ø—Ä–æ–ø–∏—Å–∞—Ç—å-–∞–¥—Ä–µ—Å-–±—Ä–æ–∫–µ—Ä–∞)
    *   [4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å](#4-–∫–∞–∫-—Ä–∞–±–æ—Ç–∞–µ—Ç-–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π-–∫–ª–∞—Å—Å)
    *   [5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–ø–∏–∫–∞](#5-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–Ω–æ–≤–æ–≥–æ-—Ç–æ–ø–∏–∫–∞)
    *   [6. –ü—Ä–∏–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–æ–ø–∏–∫–∞](#6-–ø—Ä–∏–º–µ—Ä-–∫–ª–∏–µ–Ω—Ç–∞-–¥–ª—è-–Ω–æ–≤–æ–≥–æ-—Ç–æ–ø–∏–∫–∞)
*   [7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö](#7-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-–≤-—Ç–µ—Å—Ç–∞—Ö)
*   [‚ö° –†–∞–±–æ—Ç–∞ —Å Redis](#—Ä–∞–±–æ—Ç–∞-—Å-redis)
    *   [1. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å Redis](#1-–∫–∞–∫-—É—Å—Ç—Ä–æ–µ–Ω–∞-—Ä–∞–±–æ—Ç–∞-—Å-redis)
    *   [2. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ](#2-–∫–∞–∫-–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-1)
    *   [3. –ì–¥–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞](#3-–≥–¥–µ-–ø—Ä–æ–ø–∏—Å–∞—Ç—å-–∞–¥—Ä–µ—Å-—Å–µ—Ä–≤–µ—Ä–∞)
    *   [4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å](#4-–∫–∞–∫-—Ä–∞–±–æ—Ç–∞–µ—Ç-–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π-–∫–ª–∞—Å—Å-1)
    *   [5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞](#5-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-–Ω–æ–≤–æ–≥–æ-–∏–Ω—Å—Ç–∞–Ω—Å–∞)
    *   [6. –ü—Ä–∏–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞](#6-–ø—Ä–∏–º–µ—Ä-–∫–ª–∏–µ–Ω—Ç–∞-–¥–ª—è-–Ω–æ–≤–æ–≥–æ-–∏–Ω—Å—Ç–∞–Ω—Å–∞)
    *   [7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö](#7-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-–≤-—Ç–µ—Å—Ç–∞—Ö-1)

*(–ü–æ –º–µ—Ä–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ–∫—Ü–∏–π, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)*

---

##  –ì–∞–π–¥ –ø–æ –æ—Ç–ø—Ä–∞–≤–∫–µ HTTP‚Äë–∑–∞–ø—Ä–æ—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ—Ç–≤–µ—Ç–∞

---

### 1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞

–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ Java-–∫–ª–∞—Å—Å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ JSON —Ç–µ–ª–∞ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ Lombok (`@Data`, `@Builder`, `@NoArgsConstructor`, `@AllArgsConstructor`) –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –±–æ–π–ª–µ—Ä–ø–ª–µ–π—Ç-–∫–æ–¥–∞.

```java
package com.uplatform.example.models;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.math.BigDecimal;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class BetRequestBody {
    private String     sessionToken;
    private BigDecimal amount;
    private String     transactionId;
    private String     type;        
    private String     roundId;
    private Boolean    roundClosed;
}
```

### 2. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ Java-–∫–ª–∞—Å—Å –¥–ª—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ JSON —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞.

```java
package com.uplatform.example.models; 

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.math.BigDecimal;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class GamblingResponseBody {
    private BigDecimal balance;
    private String     transactionId;
}
```

### 3. –û–ø–∏—Å–∞—Ç—å HTTP‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ Feign‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Feign –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤–∞—à–µ–≥–æ HTTP API –∫–ª–∏–µ–Ω—Ç–∞.
–£–∫–∞–∂–∏—Ç–µ name –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Spring).
–ó–∞–¥–∞–π—Ç–µ –±–∞–∑–æ–≤—ã–π URL (url) —á–µ—Ä–µ–∑ property ${app.api.manager.base-url}.

```java
package com.uplatform.example.clients; 

import com.yourcompany.models.BetRequestBody;
import com.yourcompany.models.GamblingResponseBody;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;

@FeignClient(
        name = "managerClient",
        url  = "${app.api.manager.base-url}"
)
public interface ManagerClient {

    @PostMapping("/_core_gas_processing/bet")
    ResponseEntity<GamblingResponseBody> bet(
            @RequestHeader("X-Casino-Id") String casinoId,
            @RequestHeader("Signature")   String signature,
            @RequestBody                  BetRequestBody request
    );
}
```

### 4. –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ManagerClient –≤ —Ç–µ—Å—Ç
–í –≤–∞—à–µ–º Spring Boot —Ç–µ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ @Autowired –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ Feign-–∫–ª–∏–µ–Ω—Ç–∞. –°–º. –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –Ω–∏–∂–µ (—à–∞–≥ 9).

### 5. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å
–°–æ–∑–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ (BetRequestBody) —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ (–∫–∞–∫ Signature –≤ –ø—Ä–∏–º–µ—Ä–µ), —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –µ–µ —Å –ø–æ–º–æ—â—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —É—Ç–∏–ª–∏—Ç—ã (–∑–¥–µ—Å—å httpSignatureUtil). –°–º. –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –Ω–∏–∂–µ (—à–∞–≥ 9).

### 6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
–í—ã–∑–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ –≤–∞—à–µ–≥–æ Feign-–∫–ª–∏–µ–Ω—Ç–∞ (managerClient.bet(...)), –ø–µ—Ä–µ–¥–∞–≤ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –∑–∞–≥–æ–ª–æ–≤–∫–∏ (X-Casino-Id, Signature) –∏ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (bet). –°–º. –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –Ω–∏–∂–µ (—à–∞–≥ 9).

### 7. –°–¥–µ–ª–∞—Ç—å –∞—Å—Å–µ—Ä—Ç—ã
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JUnit 5 assertAll –∏ –¥—Ä—É–≥–∏–µ –∞—Å—Å–µ—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞: —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞, –Ω–∞–ª–∏—á–∏—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞. –°–º. –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –Ω–∏–∂–µ (—à–∞–≥ 9).

### 8. –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –∑–∞ –∞—Ç—Ç–∞—á–∏ ‚ú®
AllureFeignLoggerConfig –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –≤—Å—é —Ä–∞–±–æ—Ç—É –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∞—Ç—Ç–∞—á–∞–º –¥–ª—è Allure-–æ—Ç—á–µ—Ç–∞. –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è —ç—Ç–æ–≥–æ.

![–ü—Ä–∏–º–µ—Ä –∞—Ç—Ç–∞—á–µ–π Http Request/Response –≤ Allure –æ—Ç—á–µ—Ç–µ](src/test/resources/%D0%A1%D0%BA%D1%80%D0%B8%D0%BD%D1%88%D0%BE%D1%82%2021-04-2025%20132058.jpg)


### 9. –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ (BetApiTest.java)
–í–æ—Ç –∫–∞–∫ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –≤—Å–µ —à–∞–≥–∏:

```java
com.uplatform.example.test; 

import com.yourcompany.clients.ManagerClient;
import com.yourcompany.models.BetRequestBody;
import com.yourcompany.models.GamblingResponseBody;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;

import java.math.BigDecimal;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest // –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç Spring Boot –¥–ª—è —Ç–µ—Å—Ç–∞
class BetApiTest {

    // --- –®–∞–≥ 4: –ò–Ω–∂–µ–∫—Ç–∏–º –Ω–∞—à Feign –∫–ª–∏–µ–Ω—Ç   ---
    @Autowired
    private ManagerClient managerClient;                                         

    @Test
    void shouldSuccessfullyPlaceBetAndReturnBalance() {
       step("Manager API: –°–æ–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏", () -> {
            // --- –®–∞–≥ 5: –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å ---
            String transactionId = UUID.randomUUID().toString();
            String roundId = UUID.randomUUID().toString();
            String sessionToken = "95aa0509-21f3-4985-9950-92a2da95244d"; // –ò–≥—Ä–æ–≤—É—é —Å–µ—Å—Å–∏—é –º—ã "–≤—ã–¥—É–º–∞–ª–∏" –∑–∞—Ä–∞–Ω–µ–µ, —á—Ç–æ–± –Ω–µ –æ—Ç—è–≥–æ—â–∞—Ç—å –ø—Ä–∏–º–µ—Ä
            String casinoId = "demo-casino";
    
            BetRequestBody betRequest = BetRequestBody.builder()
                    .sessionToken(sessionToken)
                    .amount(new BigDecimal("10.15"))
                    .transactionId(transactionId)
                    .type("bet")
                    .roundId(roundId)
                    .roundClosed(false)
                    .build();
    
    
            // --- –®–∞–≥ 6: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å ---
            ResponseEntity<GamblingResponseBody> response = managerClient.bet(
                    casinoId,   // –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è X-Casino-Id
                    signature,  // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
                    betRequest  // –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
            );
        
            // --- –®–∞–≥ 7: –°–¥–µ–ª–∞—Ç—å –∞—Å—Å–µ—Ä—Ç—ã ---
            assertAll("–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å Bet",
                    () -> assertEquals(HttpStatus.OK, response.getStatusCode(), "–û–∂–∏–¥–∞–ª—Å—è —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ OK (200)"),
                    () -> assertEquals(transactionId, responseBody.getTransactionId(), "TransactionId –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º"),
                    () ->  assertNotNull(responseBody.getBalance(), "–ü–æ–ª–µ balance –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å null")
            );
        });
    }
}
```

---

## –†–∞–±–æ—Ç–∞ —Å Kafka

### 1. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å Kafka

–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è Kafka —á–∏—Ç–∞—é—Ç—Å—è —Ñ–æ–Ω–æ–≤—ã–º —Å–µ—Ä–≤–∏—Å–æ–º. 
–ö–ª–∞—Å—Å `KafkaBackgroundConsumer` –∑–∞–ø—É—Å–∫–∞–µ—Ç `KafkaPollingService`. 
`KafkaPollingService` —Å–æ–∑–¥–∞—ë—Ç `KafkaMessageListenerContainer` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ–ø–∏–∫–∞ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ–≥–æ. 
–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä `MessageBuffer`, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Å–æ–±–æ–π –∫–æ–ª—å—Ü–µ–≤—É—é –æ—á–µ—Ä–µ–¥—å. 
–ü–æ–∏—Å–∫ –ø–æ –±—É—Ñ–µ—Ä—É –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç `MessageFinder`, –≤–æ–∑–≤—Ä–∞—â–∞—è —Ç–µ—Å—Ç—É DTO –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞.

### 2. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ —É–∫–∞–∂–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ `-Denv=<–∏–º—è_–æ–∫—Ä—É–∂–µ–Ω–∏—è>`. 
–í –∫–∞—Ç–∞–ª–æ–≥–µ `configs` —Ö—Ä–∞–Ω—è—Ç—Å—è json-—Ñ–∞–π–ª—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π. 
–í —Ä–∞–∑–¥–µ–ª–µ `kafka` –∑–∞–¥–∞—é—Ç—Å—è `bootstrapServer`, `groupId`, —Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ç–∞–π–º-–∞—É—Ç—ã, —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ –∏ —Ç. –ø.).

### 3. –ì–¥–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å –±—Ä–æ–∫–µ—Ä–∞

–ê–¥—Ä–µ—Å–∞ –±—Ä–æ–∫–µ—Ä–æ–≤ –∏ –Ω–∞–±–æ—Ä –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–µ–º—ã—Ö —Ç–æ–ø–∏–∫–æ–≤ –∑–∞–¥–∞—é—Ç—Å—è –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ó–Ω–∞—á–µ–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è –∫–ª–∞—Å—Å–æ–º `DynamicPropertiesConfigurator` –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `KafkaConsumerConfig`. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏–∑ `beta-09.json`:

```json
"kafka": {
  "bootstrapServer": "kafka-development-01.b2bdev.pro:9092,kafka-development-02.b2bdev.pro:9092,kafka-development-03.b2bdev.pro:9092",
  "groupId": "cb-wallet-test-consumer-beta-09",
  "listenTopicSuffixes": [
    "player.v1.account",
    "wallet.v8.projectionSource",
    "core.gambling.v1.GameSessionStart",
    "limits.v2"
    "bonus.v1.award" // –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫
  ]
}
```

### 4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å

–ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç `AbstractKafkaClient` –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ `MessageBuffer`. 
–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –Ω–∞—Å–ª–µ–¥—É—é—Ç –µ–≥–æ –∏ —É–∫–∞–∑—ã–≤–∞—é—Ç —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ DTO.

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
- `expectMessage(filter, messageClass)` ‚Äî –∂–¥—ë—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–µ–µ —Ñ–∏–ª—å—Ç—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –∫–ª—é—á—É `sequence`).
- `expectUniqueMessage(filter, messageClass)` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ –Ω–∞–π–¥–µ–Ω–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
–¢–∞–∫–∂–µ –∫–ª–∞—Å—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∞–π–º-–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.

### 5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–ø–∏–∫–∞

1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–∏—Ö–æ–¥—è—â–µ–≥–æ –≤ —Ç–æ–ø–∏–∫, –∏ –ø–æ –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ DTO –≤ –ø–∞–∫–µ—Ç–µ `api/kafka/dto`.
2. –ó–∞—Ç–µ–º –Ω–∞–ø–∏—à–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç –≤ `api/kafka/client`, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π `AbstractKafkaClient`(–ü—Ä–∏–º–µ—Ä –Ω–∏–∂–µ)
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É DTO –∏ —Å—É—Ñ—Ñ–∏–∫—Å–æ–º —Ç–æ–ø–∏–∫–∞ –≤ `KafkaConsumerConfig`.
–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –º–µ—Ç–æ–¥–∞ `kafkaTopicMappingRegistry` —Å–æ –≤—Å–µ–º–∏ –º–∞–ø–ø–∏–Ω–≥–∞–º–∏ –∏ –Ω–æ–≤—ã–º —Ç–æ–ø–∏–∫–æ–º:
```java
@Bean
public KafkaTopicMappingRegistry kafkaTopicMappingRegistry() {
    Map<Class<?>, String> mappings = new HashMap<>();

    // —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–ø–∏–∫–∏
    mappings.put(PlayerAccountMessage.class, "player.v1.account");
    mappings.put(WalletProjectionMessage.class, "wallet.v8.projectionSource");
    mappings.put(GameSessionStartMessage.class, "core.gambling.v1.GameSessionStart");
    mappings.put(LimitMessage.class, "limits.v2");

    // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫
    mappings.put(BonusAwardMessage.class, "bonus.v1.award");

    return new SimpleKafkaTopicMappingRegistry(mappings);
}
```
4. –£–∫–∞–∂–∏—Ç–µ —ç—Ç–æ—Ç —Å—É—Ñ—Ñ–∏–∫—Å –≤ —Å–ø–∏—Å–∫–µ `listenTopicSuffixes` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
   –ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ json –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–æ–ø–∏–∫–∞:

   ```json
   "listenTopicSuffixes": [
     "player.v1.account",
     "wallet.v8.projectionSource",
     "core.gambling.v1.GameSessionStart",
     "limits.v2",
     "bonus.v1.award" // –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫
   ]
   ```
   –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ `MessageBuffer` –Ω–∞—á–Ω—ë—Ç —Å–ª—É—à–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–ø–∏–∫.

### 6. –ü—Ä–∏–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–æ–ø–∏–∫–∞


```java
package com.uplatform.wallet_tests.api.kafka.client;

import com.uplatform.wallet_tests.api.kafka.consumer.KafkaBackgroundConsumer;
import com.uplatform.wallet_tests.api.kafka.dto.BonusAwardMessage;
import com.uplatform.wallet_tests.config.EnvironmentConfigurationProvider;
import org.springframework.stereotype.Component;

import java.util.Map;

@Component
public class BonusAwardKafkaClient extends AbstractKafkaClient {

    public BonusAwardKafkaClient(
            KafkaBackgroundConsumer kafkaBackgroundConsumer,
            EnvironmentConfigurationProvider configProvider
    ) {
        super(kafkaBackgroundConsumer, configProvider);
    }

    public BonusAwardMessage expectBonusAward(String playerId) {
        return expectMessage(
                Map.of("playerId", playerId),
                BonusAwardMessage.class
        );
    }
}
```

–¢–∞–∫–æ–π –∫–ª–∞—Å—Å –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–∞–∫–µ—Ç `api/kafka/client` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Spring.

### 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö

–ò–Ω–∂–µ–∫—Ç–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –≤ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å –∏ –æ–∂–∏–¥–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ –≤–Ω—É—Ç—Ä–∏ `Allure.step`:

```java
@Autowired
private WalletProjectionKafkaClient walletProjectionKafkaClient;

step("Kafka: –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è", () -> {
    var message = walletProjectionKafkaClient.expectWalletProjectionMessageBySeqNum(
            testData.someEvent.getSequence());
    assertTrue(utils.areEquivalent(message, testData.someEvent));
});
```

## –†–∞–±–æ—Ç–∞ —Å Redis

### 1. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å Redis

–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `AbstractRedisClient` –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –æ–±—â–µ–Ω–∏—è —Å Redis:
–æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã `getWithRetry` –∏
`getWithCheck` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–≤—Ç–æ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ `RedisRetryHelper` –∏
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∞—Ç—Ç–∞—á–∏ –≤ Allure –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ
–∫–ª–∏–µ–Ω—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä `PlayerRedisClient` –∏ `WalletRedisClient`, –ª–∏—à—å —Ä–∞—Å—à–∏—Ä—è—é—Ç
–µ–≥–æ –∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–≤–æ–∏—Ö –∫–ª—é—á–µ–π.

### 2. –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º —Å–≤–æ–π—Å—Ç–≤–æ–º `-Denv=<–∏–º—è_–æ–∫—Ä—É–∂–µ–Ω–∏—è>`. –í –∫–∞—Ç–∞–ª–æ–≥–µ
`configs` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –≥–¥–µ —Ä–∞–∑–¥–µ–ª `redis` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤—Ç–æ—Ä–æ–≤
–∏ —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤. –ü—Ä–∏–º–µ—Ä –∏–∑ `beta-09.json`:

```json
"redis": {
    "aggregate": {
        "maxGamblingCount": 50,
        "maxIframeCount": 500,
        "retryAttempts": 10,
        "retryDelayMs": 200
    },
    "instances": {
        "player": {
          "host": "redis-01.b2bdev.pro",
          "port": 6389,
          "database": 9,
          "timeout": "5000ms",
          "lettucePool": {
            "maxActive": 8,
            "maxIdle": 8,
            "minIdle": 0,
            "shutdownTimeout": "100ms"
          }
        },
        "wallet": {
          "host": "redis-01.b2bdev.pro",
          "port": 6390,
          "database": 9,
          "timeout": "5000ms",
          "lettucePool": {
            "maxActive": 8,
            "maxIdle": 8,
            "minIdle": 0,
            "shutdownTimeout": "100ms"
          }
        }
    }
}
```

### 3. –ì–¥–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≤ —ç—Ç–æ–º –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –≤ —Ä–∞–∑–¥–µ–ª–µ
`redis.instances`. –ö–ª–∞—Å—Å `DynamicPropertiesConfigurator` —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏
–ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ `RedisConfig`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ `RedisTemplate`.

### 4. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å

`AbstractRedisClient` –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Redis —Å
–ø–æ–≤—Ç–æ—Ä–∞–º–∏. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `RedisRetryHelper` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞ –∏
—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∞—Ç—Ç–∞—á–∏ –≤ Allure –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–µ. –î–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏
–ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### 5. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞

1. –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –≤ `redis.instances` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ
   —Ñ–∞–π–ª–∞.
2. –í `RedisConfig` –æ–ø–∏—à–∏—Ç–µ –±–∏–Ω—ã `RedisProperties`, `LettuceConnectionFactory` –∏
   `RedisTemplate` –ø–æ –æ–±—Ä–∞–∑—Ü—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö.
3. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç, —Ä–∞—Å—à–∏—Ä—è—é—â–∏–π `AbstractRedisClient`.

–ü—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ `RedisConfig` –¥–ª—è –∏–Ω—Å—Ç–∞–Ω—Å–∞ `bonus`:

```java
@Bean("bonusRedisProperties")
@ConfigurationProperties(prefix = "spring.data.redis.bonus")
public RedisProperties bonusRedisProperties() {
    return new RedisProperties();
}

@Bean("bonusRedisConnectionFactory")
public LettuceConnectionFactory bonusRedisConnectionFactory(
        @Qualifier("bonusRedisProperties") RedisProperties properties) {
    return createConnectionFactory(properties, bonusLettucePoolingConfig(properties));
}

@Bean("bonusRedisTemplate")
public RedisTemplate<String, String> bonusRedisTemplate(
        @Qualifier("bonusRedisConnectionFactory") RedisConnectionFactory connectionFactory) {
    return createStringRedisTemplate(connectionFactory);
}
```

### 6. –ü—Ä–∏–º–µ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞

```java
package com.uplatform.wallet_tests.api.redis.client;

import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.data.redis.core.RedisTemplate;
import com.fasterxml.jackson.core.type.TypeReference;
import org.springframework.stereotype.Component;

@Component
public class BonusRedisClient extends AbstractRedisClient {

    public BonusRedisClient(
            @Qualifier("bonusRedisTemplate") RedisTemplate<String, String> template,
            RedisRetryHelper retryHelper,
            AllureAttachmentService attachmentService
    ) {
        super("BONUS", template, retryHelper, attachmentService);
    }

    public BonusAggregate getBonus(String key) {
        return getWithRetry(key, new TypeReference<BonusAggregate>() {});
    }
}
```

### 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö

–ò–Ω–∂–µ–∫—Ç–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —à–∞–≥–µ `Allure.step`:

```java
@Autowired
private BonusRedisClient bonusRedisClient;

step("Redis: –ø–æ–ª—É—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞", () -> {
    var aggregate = bonusRedisClient.getBonus(testData.bonusKey);
    assertNotNull(aggregate, "redis.bonus.not_null");
});
```
